<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: The FlowVR plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">0.5.1</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree reference</a>
	<li><a href="Plugins.html">Plugins</a>
	<li><a href="namespacePDI.html">Plugin API reference</a>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('FlowVR_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The FlowVR plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The FlowVR plugin hides FlowVR API calls and logic. Properly created <a class="el" href="namespacePDI.html">PDI</a> configuration file allows user to care only about proper input/output calls.</p>
<p>FlowVR plugin does not support the full FlowVR feature set.</p>
<h1><a class="anchor" id="autotoc_md34"></a>
Configuration elements</h1>
<h2><a class="anchor" id="autotoc_md35"></a>
Plugin node</h2>
<div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div></div><!-- fragment --><ul>
<li><code>flowvr</code> name of the plugin, must be children of <code>plugins</code> node</li>
</ul>
<h2><a class="anchor" id="autotoc_md36"></a>
Component node</h2>
<p>Available components: <code>module</code></p>
<p>Case 1:</p>
<div class="fragment"><div class="line">flowvr:</div><div class="line">  component: module</div><div class="line">  ...</div></div><!-- fragment --><ul>
<li><code>flowvr</code> has single subtree in which <code>component</code> is defined</li>
<li>only one module will be loaded by calling <code>PDI_init</code></li>
</ul>
<p>Case 2:</p>
<div class="fragment"><div class="line">flowvr:</div><div class="line">  - component: module</div><div class="line">    ...</div><div class="line">  - component: module</div><div class="line">    ...</div></div><!-- fragment --><ul>
<li><code>flowvr</code> has an array in which <code>component</code>s are defined</li>
<li><code>PDI_init</code> will load all defined modules</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
Component descriptors</h2>
<p>FlowVR does not define any default descriptors. <b>User has to define all descriptors</b> in <code>data</code> tree outside flowvr tree.</p>
<h3><a class="anchor" id="autotoc_md38"></a>
wait_on_data</h3>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div></div><!-- fragment --><ul>
<li><code>wait_on_data</code> holds name of the descriptor (data)</li>
<li><code>wait_desc</code> is a descriptor where <a class="el" href="namespacePDI.html">PDI</a> will write value returned by module <code>wait</code> method</li>
<li><code>wait_desc</code> must be an integer</li>
<li>every time user use <code>wait desc</code> (by <code>PDI_expose</code>) <a class="el" href="namespacePDI.html">PDI</a> will call <code>wait</code> on FlowVR module</li>
<li><code>wait_desc</code> must be called with write access: <code>PDI_expose("wait_desc", &amp;wait, PDI_IN)</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md39"></a>
wait_on</h3>
<div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on: &quot;wait_event&quot;</div></div><!-- fragment --><ul>
<li><code>wait_on</code> holds name of the event on which <a class="el" href="namespacePDI.html">PDI</a> should abort FlowVR module</li>
<li>should be avoided if possible (not returning the wait status)</li>
<li><code>wait_on</code> can be an array of events:</li>
</ul>
<div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on: [&quot;wait_event_1&quot;, &quot;wait_event_2&quot;]</div></div><!-- fragment --><h3><a class="anchor" id="autotoc_md40"></a>
status</h3>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  status_desc_1: int</div><div class="line">  status_desc_2: int</div><div class="line">  status_desc_3: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    - component: module_1</div><div class="line">      wait_on_data: wait_desc</div><div class="line">      status: status_desc_1</div><div class="line">    - component: module_2</div><div class="line">      wait_on_data: wait_desc</div><div class="line">      status: [status_desc_2, status_desc_3]</div></div><!-- fragment --><ul>
<li><code>status</code> holds name (or array of names) of the descriptor (data)</li>
<li><code>status_desc_x</code> is a descriptor where <a class="el" href="namespacePDI.html">PDI</a> will write value returned by module <code>status</code> method</li>
<li><code>status_desc_x</code> must be an integer</li>
<li>every time user use <code>status_desc_x</code> (by PDI_expose) <a class="el" href="namespacePDI.html">PDI</a> will call <code>status</code> on FlowVR module</li>
<li><code>status_desc_x</code> must be called with write access: <code>PDI_expose("status_desc_x", &amp;status_x, PDI_IN)</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md41"></a>
abort_on</h3>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    - component: module_1</div><div class="line">      wait_on_data: wait_desc</div><div class="line">      abort_on: &quot;abort_event_1&quot;</div><div class="line">    - component: module_2</div><div class="line">      wait_on_data: wait_desc</div><div class="line">      abort_on: [&quot;abort_event_1&quot;, &quot;abort_event_2&quot;, &quot;abort_event_3&quot;]</div></div><!-- fragment --><ul>
<li><code>abort_on</code> holds names (or array of names) of the event on which <a class="el" href="namespacePDI.html">PDI</a> will call <code>abort</code> method</li>
</ul>
<h2><a class="anchor" id="autotoc_md42"></a>
parallel</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  par_rank_desc: int</div><div class="line">  par_size_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    parallel:</div><div class="line">      get_rank: par_rank_desc</div><div class="line">      get_size: par_size_desc</div></div><!-- fragment --><ul>
<li><code>par_rank_desc</code> is a descriptor where <a class="el" href="namespacePDI.html">PDI</a> will write the rank of the process</li>
<li><code>par_size_desc</code> is a descriptor where <a class="el" href="namespacePDI.html">PDI</a> will write the size of the world</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  par_rank_desc: int</div><div class="line">  par_size_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    parallel:</div><div class="line">      set_rank: $par_rank_desc</div><div class="line">      set_size: $par_size_desc</div></div><!-- fragment --><ul>
<li><code>$par_rank_desc</code> is a value of rank process to pass to flowvr</li>
<li><code>$par_size_desc</code> is a value of world size to pass to flowvr</li>
</ul>
<h2><a class="anchor" id="autotoc_md43"></a>
Input_ports</h2>
<div class="fragment"><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    ...</div></div><!-- fragment --><ul>
<li><code>input_ports</code> each port will be set as <code>flowvr input port</code> of the module</li>
</ul>
<h2><a class="anchor" id="autotoc_md44"></a>
Output_ports</h2>
<div class="fragment"><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    ...</div></div><!-- fragment --><ul>
<li><code>output_ports</code> each port will be set as <code>flowvr output port</code> of the module</li>
</ul>
<h2><a class="anchor" id="autotoc_md45"></a>
Input_port message</h2>
<p>Default type of input port. Flowvr message consists of:</p>
<ul>
<li><code>data (payload)</code> simple binary data</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  data_descriptor_name: {type: array, subtype: int, size: 32}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    port_1_name:</div><div class="line">      data: data_descriptor_name</div><div class="line">      stamps:</div><div class="line">        ...</div><div class="line">    port_2_name:</div><div class="line">      event_port: true</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>data</code> is the name of the descriptor where FlowVR plugin will write payload</li>
<li><code>stamps</code> the stamps that will be signed to each message received by this port</li>
</ul>
</li>
<li><code>port_2_name</code> is the name of the second port<ul>
<li><code>event_port</code> set to true means that this port is defined as event port (non-blocking)</li>
<li><code>stamps</code> the stamps that will be signed to each message received by this port</li>
<li>no <code>data</code> node means that this is STAMP port (message has no payload)</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">metadata:</div><div class="line">  received_size : int</div><div class="line">data:</div><div class="line">  data_descriptor_name: {type: array, subtype: int, size: $received_size/4}</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    ...</div><div class="line">    input_ports:</div><div class="line">      port_1_name:</div><div class="line">        data: data_descriptor_name</div><div class="line">        size: received_size</div></div><!-- fragment --><p>The user can not always predict how many elements FlowVR will receive. In this case <code>size</code> node type must be a name of metadata where to write the size of received message. The <code>received_size</code> will hold the size of received array, but plugin will set it <b>after</b> user access the <code>data_descriptor_name</code> descriptor. The <code>size</code> property of descriptor should be divided by size of element.</p>
<h2><a class="anchor" id="autotoc_md46"></a>
Output_port message</h2>
<p>Default type of output port. Flowvr message consists of:</p>
<ul>
<li><code>data (payload)</code> simple binary data</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  data_descriptor_name:  {type: array, subtype: int, size: 32}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_1_name:</div><div class="line">      data: data_descriptor_name</div><div class="line">      data_size: const</div><div class="line">      stamps:</div><div class="line">        ...</div><div class="line">    port_2_name:</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>data</code> is the name of the descriptor from where FlowVR plugin will read payload</li>
<li><code>data_size</code> set to <code>const</code> means that size of the data will not change (plugin will use FlowVR buffer pools)</li>
<li><code>stamps</code> the stamps that will be signed to each message sent by this port</li>
</ul>
</li>
<li><code>port_2_name</code> is the name of the second port<ul>
<li><code>stamps</code> the stamps that will be signed to each message sent by this port</li>
<li>no <code>data</code> node means that this is STAMP port (message has no payload)</li>
</ul>
</li>
</ul>
<p>User can specify the subsize of data to send in <code>copy_data_selection</code>:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  data_descriptor_name:  {type: array, subtype: int, size: [32, 32]}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_1_name:</div><div class="line">      data: data_descriptor_name</div><div class="line">      copy_data_selection:</div><div class="line">        type: array</div><div class="line">        subtype: int</div><div class="line">        size: [32, 32]</div><div class="line">        subsize: [30, 30]</div><div class="line">        start: [1, 1]</div><div class="line">      data_size: const</div><div class="line">      stamps:</div><div class="line">        ...</div><div class="line">    port_2_name:</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><p><code>copy_data_selection</code> has to containt a valid <a class="el" href="namespacePDI.html">PDI</a> type</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Stamp</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  descriptor_name: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_name:</div><div class="line">      stamps:</div><div class="line">        stamp_name: descriptor_name</div></div><!-- fragment --><ul>
<li><code>stamp_name</code> is the name of the stamp inside the FlowVR library</li>
<li>type of the descriptor must be a valid <a class="el" href="namespacePDI.html">PDI</a> type, limited to:<ul>
<li><code>int</code></li>
<li><code>float</code></li>
<li><code>array of ints</code></li>
<li><code>array of floats</code></li>
<li><code>array of chars</code></li>
</ul>
</li>
<li><code>descriptor_name</code> is the name of the descriptor where FlowVR plugin will read/write stamp value</li>
</ul>
<h2><a class="anchor" id="autotoc_md48"></a>
*Stamp as expression*</h2>
<p>For output port user can define stamp as expression value (stamp need type definition in this case):</p>
<div class="fragment"><div class="line">metadata:</div><div class="line">  descriptor_name: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_name:</div><div class="line">      stamps:</div><div class="line">        stamp_name:</div><div class="line">          type: int</div><div class="line">          expression: ($descriptor_name/2) + 3</div></div><!-- fragment --><p>For now only int and string stamps are supported as expression.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Input_port chunks</h2>
<p>Chunks allows user to put multiple data in single message. </p><hr/>
<p> WARNING</p>
<p>After each wait, the first access to the any descriptor (that belongs to the chunks) will allocate the memory for the all descriptors. This means that all sizes (if stored as metadata) should be set before first access to any of the descriptors. </p><hr/>
<div class="fragment"><div class="line">data:</div><div class="line">  chunk_1_name: int</div><div class="line">  chunk_2_name: {type: array, subtype: char, size: 255}</div><div class="line">  chunk_3_name: float</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    port_name:</div><div class="line">      chunks:</div><div class="line">        - data: chunk_1_name</div><div class="line">        - data: chunk_2_name</div><div class="line">        - data: chunk_3_name</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>chunks</code> indicates that message will hold many data</li>
</ul>
<h2><a class="anchor" id="autotoc_md52"></a>
Output_port chunks</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  chunk_1_name: int</div><div class="line">  chunk_2_name: {type: array, subtype: char, size: 255}</div><div class="line">  chunk_3_name: float</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_name:</div><div class="line">      chunks:</div><div class="line">        - data: chunk_1_name</div><div class="line">        - data: chunk_2_name</div><div class="line">        - data: chunk_3_name</div></div><!-- fragment --><ul>
<li><code>chunks</code> indicates that message will hold many data</li>
</ul>
<h2><a class="anchor" id="autotoc_md53"></a>
Input_port event button</h2>
<p>Only when port has a child node named <code>event_button</code>. Flowvr message consists of:</p>
<ul>
<li><code>event_button (payload)</code> flowvr chunk with buttons</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line">  left: int</div><div class="line">  right: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    port_1_name:</div><div class="line">      event_button:</div><div class="line">        KEY_UP: up</div><div class="line">        KEY_DOWN: down</div><div class="line">        KEY_LEFT: left</div><div class="line">        KEY_RIGHT: right</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>event_button</code> indicates that this is <code>button event port</code></li>
<li><code>KEY_UP</code> is the predefined name of the <code>up arrow button</code></li>
<li><code>KEY_DOWN</code> is the predefined name of the <code>down arrow button</code></li>
<li><code>KEY_LEFT</code> is the predefined name of the <code>left arrow button</code></li>
<li><code>KEY_RIGHT</code> is the predefined name of the <code>right arrow button</code></li>
<li><code>up, down, left, right</code> are the name of the descriptor from where plugin will read the state of the buttons</li>
<li><code>stamps</code> the stamps that will be signed to each message received by this port</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md54"></a>
Output_port button event</h2>
<p>Only when port has a child node named <code>event_button</code>. Flowvr message consists of:</p>
<ul>
<li><code>event_button (payload)</code> flowvr chunk with buttons</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line">  left: int</div><div class="line">  right: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_1_name:</div><div class="line">      event_button:</div><div class="line">        KEY_UP: up</div><div class="line">        KEY_DOWN: down</div><div class="line">        KEY_LEFT: left</div><div class="line">        KEY_RIGHT: right</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>event_button</code> indicates that this is <code>button event port</code></li>
<li><code>KEY_UP</code> is the predefined name of the <code>up arrow button</code></li>
<li><code>KEY_DOWN</code> is the predefined name of the <code>down arrow button</code></li>
<li><code>KEY_LEFT</code> is the predefined name of the <code>left arrow button</code></li>
<li><code>KEY_RIGHT</code> is the predefined name of the <code>right arrow button</code></li>
<li><code>up, down, left, right</code> are the name of the descriptor where plugin will write the state of the buttons</li>
<li><code>stamps</code> the stamps that will be signed to each message sent by this port</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md55"></a>
Full list of predefined keys</h3>
<ul>
<li>KEY_F1 -&gt; F1</li>
<li>KEY_F2 -&gt; F2</li>
<li>KEY_F3 -&gt; F3</li>
<li>KEY_F4 -&gt; F4</li>
<li>KEY_F5 -&gt; F5</li>
<li>KEY_F6 -&gt; F6</li>
<li>KEY_F7 -&gt; F7</li>
<li>KEY_F8 -&gt; F8</li>
<li>KEY_F9 -&gt; F9</li>
<li>KEY_F10 -&gt; F10</li>
<li>KEY_F11 -&gt; F11</li>
<li>KEY_F12 -&gt; F12</li>
<li>KEY_UP -&gt; Up Arrow</li>
<li>KEY_DOWN -&gt; Down Arrow</li>
<li>KEY_LEFT -&gt; Left Arrow</li>
<li>KEY_RIGHT -&gt; Right Arrow</li>
<li>KEY_PAGE_UP -&gt; Page Up</li>
<li>KEY_PAGE_DOWN -&gt; Page Down</li>
<li>KEY_HOME -&gt; Home</li>
<li>KEY_END -&gt; End</li>
<li>KEY_INSERT -&gt; Insert</li>
</ul>
<h2><a class="anchor" id="autotoc_md56"></a>
Input_port event mouse</h2>
<p>Only when port has a child node named <code>event_mouse</code>. Flowvr message consists of:</p>
<ul>
<li><code>event_mouse (payload)</code> flowvr chunk with mouse events</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line">  right_button: int</div><div class="line">  middle_button: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    port_name:</div><div class="line">      event_mouse:</div><div class="line">        POS_XY: pos_xy</div><div class="line">        LEFT_BUTTON: left_button</div><div class="line">        RIGHT_BUTTON: right_button</div><div class="line">        MIDDLE_BUTTON: middle_button</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>event_mouse</code> indicates that this is <code>mouse event port</code></li>
<li><code>POS_XY</code> is the predefined name of the position of the mouse (always of type <code>float[2]</code>)</li>
<li><code>LEFT_BUTTON</code> is the predefined name of the <code>left mouse button</code> (always of type <code>int</code>)</li>
<li><code>RIGHT_BUTTON</code> is the predefined name of the <code>right mouse button</code> (always of type <code>int</code>)</li>
<li><code>MIDDLE_BUTTON</code> is the predefined name of the <code>middle mouse button</code> (always of type <code>int</code>)</li>
<li><code>stamps</code> the stamps that will be signed to each message received by this port</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md57"></a>
Output_port mouse event</h2>
<p>Only when port has a child node named <code>event_mouse</code>. Flowvr message consists of:</p>
<ul>
<li><code>event_mouse (payload)</code> flowvr chunk with mouse events</li>
<li><code>stamps</code> flowvr stamps</li>
</ul>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line">  right_button: int</div><div class="line">  middle_button: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_name:</div><div class="line">      event_mouse:</div><div class="line">        POS_XY: pos_xy</div><div class="line">        LEFT_BUTTON: left_button</div><div class="line">        RIGHT_BUTTON: right_button</div><div class="line">        MIDDLE_BUTTON: middle_button</div><div class="line">      stamps:</div><div class="line">        ...</div></div><!-- fragment --><ul>
<li><code>port_1_name</code> is the name of the first port (this name is passed to flowvr)<ul>
<li><code>event_mouse</code> indicates that this is <code>mouse event port</code></li>
<li><code>POS_XY</code> is the predefined name of the position of the mouse (always of type <code>float[2]</code>)</li>
<li><code>LEFT_BUTTON</code> is the predefined name of the <code>left mouse button</code> (always of type <code>int</code>)</li>
<li><code>RIGHT_BUTTON</code> is the predefined name of the <code>right mouse button</code> (always of type <code>int</code>)</li>
<li><code>MIDDLE_BUTTON</code> is the predefined name of the <code>middle mouse button</code> (always of type <code>int</code>)</li>
<li><code>stamps</code> the stamps that will be signed to each message sent by this port</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md58"></a>
Traces</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  trace_descriptor: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  traces:</div><div class="line">    trace_name:</div><div class="line">      on_data: trace_descriptor</div></div><!-- fragment --><ul>
<li><code>trace_name</code> is the name of the trace passed to flowvr</li>
<li><code>on_data</code> is the name of the descriptor where trace value is stored, every <code>PDI_expose</code> or <code>PDI_share</code> on this descriptor writes trace</li>
<li><code>on_data</code> type must be <code>int</code>, <code>float</code> and <code>array of chars</code></li>
</ul>
<p>The following instruction writes trace:</p>
<div class="fragment"><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;trace_descriptor&quot;</span>, &amp;trace_value, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md59"></a>
Reading and writing data</h1>
<p>FlowVR plugin uses 2 ways to handle data reading and writing:</p>
<ol type="1">
<li>Access the shared memory - the fastest way, user operates on flowvr shared memory.</li>
<li>Copy the data from shared memory to descriptor - needs the data copy (convenient for small messages).</li>
</ol>
<h2><a class="anchor" id="autotoc_md60"></a>
Read data from FlowVR message by access the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text_shr: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        data: text_shr</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span>* text_shr;</div><div class="line"><a class="code" href="group__annotation.html#ga8dcd0c81d7697ea473a55bd57efb717d">PDI_access</a>(<span class="stringliteral">&quot;text_shr&quot;</span>, (<span class="keywordtype">void</span>**)&amp;text_shr, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="comment">// do something with text_shr or copy data to local buffer</span></div><div class="line"></div><div class="line"><a class="code" href="group__annotation.html#ga001117ae897dd4e4a25c312b5d00c43a">PDI_release</a>(<span class="stringliteral">&quot;text_shr&quot;</span>); <span class="comment">// really important to release descriptors</span></div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md61"></a>
Write data from FlowVR message by access the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text_shr: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: text_shr</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span>* text_shr;</div><div class="line"><a class="code" href="group__annotation.html#ga8dcd0c81d7697ea473a55bd57efb717d">PDI_access</a>(<span class="stringliteral">&quot;text_shr&quot;</span>, (<span class="keywordtype">void</span>**)&amp;text_shr, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="comment">// do something with text_shr or copy data from local buffer</span></div><div class="line"></div><div class="line"><a class="code" href="group__annotation.html#ga001117ae897dd4e4a25c312b5d00c43a">PDI_release</a>(<span class="stringliteral">&quot;text_shr&quot;</span>); <span class="comment">// really important to release descriptors</span></div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md62"></a>
Read data from FlowVR message by copy from the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        data: text</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span> text[4];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;text&quot;</span>, text, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md63"></a>
Write data to FlowVR message by copy to the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: text</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span> text[4];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;text&quot;</span>, text, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md64"></a>
Write data to FlowVR message by copy the subset of data to the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  my_array: {type: array, subtype: int, size: [20, 20]}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: my_array</div><div class="line">        copy_data_selection: {type: array, subtype: int, size: [20, 20], subsize: [10, 10], start: [0, 0]}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> my_array[400];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;my_array&quot;</span>, my_array, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>); <span class="comment">// copies only 100 elements</span></div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md65"></a>
Reading and writing stamps</h1>
<p>Stamps are always copied from descriptor to flowvr message.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Read stamp from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  stamp_it: int</div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        stamps:</div><div class="line">          it: stamp_it</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> stamp_it = some_value;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;stamp_it&quot;</span>, &amp;stamp_it, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md67"></a>
Write stamp from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  user_stamp: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        stamps:</div><div class="line">          user_defined_stamp: user_stamp</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> user_stamp = some_value;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;user_stamp&quot;</span>, &amp;user_stamp, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md68"></a>
Reading and writing mouse event</h1>
<h2><a class="anchor" id="autotoc_md69"></a>
Write mouse event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      keysOut:</div><div class="line">        event_mouse:</div><div class="line">          POS_XY: pos_xy</div><div class="line">          LEFT_BUTTON: left_button</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">float</span> pos_xy[2] = {x_pos, y_pos};</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;pos_xy&quot;</span>, &amp;pos_xy, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> left_button = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;left_button&quot;</span>, &amp;left_button, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md70"></a>
Read mouse event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line"></div><div class="line">...</div><div class="line">input_ports:</div><div class="line">  keysIn:</div><div class="line">    event_mouse:</div><div class="line">      POS_XY: pos_xy</div><div class="line">      LEFT_BUTTON: left_button</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">float</span> pos_xy;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;pos_xy&quot;</span>, &amp;pos_xy, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> left_button;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;left_button&quot;</span>, &amp;left_button, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md71"></a>
Write button event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      keysOut:</div><div class="line">        event_button:</div><div class="line">          KEY_UP: up</div><div class="line">          KEY_DOWN: down</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> up_state = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;up&quot;</span>, &amp;up_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> down_state = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;down&quot;</span>, &amp;down_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md72"></a>
Read button event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      keysIn:</div><div class="line">        event_button:</div><div class="line">          KEY_UP: up</div><div class="line">          KEY_DOWN: down</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> up_state;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;up&quot;</span>, &amp;up_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> down_state;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;down&quot;</span>, &amp;down_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md73"></a>
Examples</h1>
<p>Path to the examples:</p>
<div class="fragment"><div class="line">pdi/build/pdi_plugin-flowvr/src/FLOWVR_PLUGIN-build/examples/</div></div><!-- fragment --><p>Original flowvr source files are in directiories <code>flowvr_original</code>.</p>
<h2><a class="anchor" id="autotoc_md74"></a>
Running the application</h2>
<ol type="1">
<li>Go to examples folder: <code>cd pdi_plugin-flowvr/src/FLOWVR_PLUGIN-build/examples</code></li>
<li>Run <code>source flowvr-config.sh</code>. Now your environment is ready.</li>
<li>Run flowvr deamon on your system (best in new terminal, repeat 1. and 2.): <code>flowvrd --top</code></li>
<li>Inside <code>$example_name</code> directory generate the flowvr configuration files by: <code>python $example_name.py</code> and run example by: <code>flowvr $example_name</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md75"></a>
Tictac example</h2>
<p>Consists of 2 modules:</p>
<ul>
<li><code>put</code><ul>
<li>source file: <code>put.cxx</code></li>
<li>configuration file: <code>put.yml</code></li>
<li>has <code>output port</code> named <code>text</code></li>
<li>sends message with:<ul>
<li><code>data</code> (payload): ```yaml type: {type: array, subtype: char, size: 4} # "tic" or "tac" ``<code> -</code>stamps<code>: -</code>it&lt;tt&gt;(predefined flowvr stamp) ``yaml type: int ``<code> -</code>my_stamp&lt;tt&gt;(user define int array stamp) ``yaml type: {type: array, subtype: int, size: 2} ```</li>
</ul>
</li>
</ul>
</li>
<li><code>get</code><ul>
<li>source file: <code>get.cxx</code></li>
<li>configuration file: <code>get.yml</code></li>
<li>has <code>input port</code> named <code>text</code></li>
<li>receive message sent by <code>put</code> module</li>
<li>additionally has defined <code>stamp</code>:<ul>
<li><code>source</code> (predefined flowvr stamp) ```yaml type: {type: array, subtype: char, size: 256} ```</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md76"></a>
Network of the application:</h3>
<div class="image">
<img src="images/tictac_net.jpg" alt="drawing" width="300"/>
</div>
<h2><a class="anchor" id="autotoc_md77"></a>
Bundle example</h2>
<p>Consists of 3 modules:</p>
<ul>
<li>2x <code>putMulitple</code><ul>
<li>source file: <code>putMulitple.cxx</code></li>
<li>configuration file: <code>putMulitple.yml</code></li>
<li>first one has <code>output port</code> named <code>text</code>, second <code>text2</code></li>
<li>sends message with:<ul>
<li><code>data</code> (payload): ```yaml type: {type: array, subtype: char, size: 4} # first "tic" or "tac", second "TIC" or "TAC" ``<code> -</code>stamps<code>: -</code>it&lt;tt&gt;(predefined flowvr stamp) ``yaml type: int ```</li>
</ul>
</li>
</ul>
</li>
<li><code>getMulitple</code><ul>
<li>source file: <code>getMulitple.cxx</code></li>
<li>configuration file: <code>getMulitple.yml</code></li>
<li>has <code>input ports</code> named <code>text</code> and <code>text2</code></li>
<li>receive message sent by <code>putMulitple</code> modules</li>
<li>additionally has defined <code>stamp</code>:<ul>
<li><code>source</code> (predefined flowvr stamp) ```yaml type: {type: array, subtype: char, size: 256} ```</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md78"></a>
Network of the application:</h3>
<div class="image">
<img src="images/bundle_net.jpg" alt="drawing" width="500"/>
</div>
<h2><a class="anchor" id="autotoc_md79"></a>
Primes example</h2>
<p>Consists of 3 modules:</p>
<ul>
<li><code>capture</code><ul>
<li>source file: <code>capture.cxx</code></li>
<li>configuration file: <code>capture.yml</code></li>
<li>has <code>output port</code> named <code>keysOut</code></li>
<li>sends message with:<ul>
<li><code>event_button</code> (payload): ```yaml KEY_UP: up KEY_DOWN: down KEY_LEFT: left KEY_RIGHT: right ```</li>
</ul>
</li>
</ul>
</li>
<li><code>compute</code><ul>
<li>source file: <code>compute.cxx</code></li>
<li>configuration file: <code>compute.yml</code></li>
<li>has <code>output port</code> named <code>primesOut</code></li>
<li>sends message with:<ul>
<li><code>data</code> (payload): ```yaml type: {type: array, subtype: int, size: $tempPrimeNumbersMaxCount} ``<code> -</code>stamps<code>: -</code>computationTimeIt<code> </code>``yaml type: int ```</li>
</ul>
</li>
</ul>
</li>
<li><code>visu</code><ul>
<li>source file: <code>visu.cxx</code></li>
<li>configuration file: <code>visu.yml</code></li>
<li>has trace <code>myTraceKeyPressedNotification</code> ```yaml type: int ``<code></code></li>
<li><code>has</code>input ports<code>named</code>primesIn<code>and</code>keysIn<code></code></li>
<li><code>receive message sent by</code>capture<code>and</code>compute` modules</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md80"></a>
Network of the application:</h3>
<div class="image">
<img src="images/primes_net.jpg" alt="drawing" width="700"/>
</div>
<h2><a class="anchor" id="autotoc_md81"></a>
Fluid example</h2>
<p>Consists of 2 modules:</p>
<ul>
<li><code>fluid</code><ul>
<li>source file: <code>fluid.cxx</code></li>
<li>configuration file: <code>fluid.yml</code></li>
<li>has <code>input port</code> named <code>position</code></li>
<li>received message sent by <code>gldens</code> module</li>
<li>has <code>output ports</code> named <code>velocity</code> and <code>density</code></li>
<li><code>velocity</code> and <code>density</code> both sends message with:<ul>
<li><code>data</code> (payload): ```yaml type: {type: array, subtype: char, size: [$NX * 2, $NY]} # where NX and NY is metadata ``<code> -</code>stamps<code>: -</code>P<code>: </code>``yaml type: {type: array, subtype: int, size: 2} ``<code> -</code>N<code>: </code>``yaml type: {type: array, subtype: int, size: 2} ```</li>
</ul>
</li>
</ul>
</li>
<li><code>gldens</code><ul>
<li>source file: <code>gldens.cxx</code></li>
<li>configuration file: <code>gldens.yml</code></li>
<li>has <code>input ports</code> named <code>velocity</code> and <code>density</code></li>
<li>received message sent by <code>fluid</code> module</li>
<li>has <code>output port</code> named <code>position</code></li>
<li>sends message with:<ul>
<li><code>data</code> (payload): ```yaml type: {type: array, subtype: float, size: 3} ``<code></code></li>
</ul>
</li>
<li><code>very important is how to get a number of elements received by</code>velocity<code>and</code>density<code>ports: </code>``yaml type: {type: array, subtype: char, size: $velocitySize} #velocitySize is defined as metadata ``<code> Here</code>velocitySize<code>must be preceded with</code>$<code>to let plugin to write the size there. The</code>velocitySize<code>descriptor will store a valid size **after** accessing the</code>velocity` descriptor, because only then plugin will write size.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md82"></a>
Network of the application:</h3>
<div class="image">
<img src="images/fluid_net.jpg" alt="drawing" width="500"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
