<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: The Decl&#39;HDF5 plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">1.2.0-alpha.2021-04-09.1b0ba44</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="Installation.html">Installation</a>
	<li><a href="PDI_usage.html">PDI usage</a>
	<li><a href="Concepts.html">Core concepts</a>
	<li><a href="First_steps.html">First steps</a>
	<li><a href="Hands_on.html">Tutorial</a>
	<li><a href="PDI_example.html">PDI example</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree</a>
	<li><a href="Plugins.html">Plugins</a>
	<li id="gitlab-ribbon"><a href="https://gitlab.maisondelasimulation.fr/pdidev/pdi">Contribute on Gitlab</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Decl_HDF5_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The Decl'HDF5 plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>WARNING</b> This documentation is a work in progress and does not reflect the full Decl'HDF5 potential.</p>
<p>The Decl'HDF5 plugin enables one to read and write data from HDF5 files in a declarative way. Decl'HDF5 does not support the full HDF5 feature set but offers a simple declarative interface to access a large subset of it.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Configuration grammar</h1>
<p>At its root, the Decl'HDF5 configuration is made of either a single <code>FILE_DESC</code> or a list of <code>FILE_DESC</code>s.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
`FILE_DESC`</h2>
<p>A <code>FILE_DESC</code> specifies a list of actions to execute in one file. It is specified by a key/value map that contains at least the <code>file</code> key. Other keys are optional. The possible values for the keys are as follow:</p><ul>
<li><code>file</code>: a string that can contain $-expressions and specified the name of the file this <code>FILE_DESC</code> refers to.</li>
<li><code>write</code>: a <code>DATA_SECTION</code> that defaults to an empty one. This <code>DATA_SECTION</code> describes writes to execute.</li>
<li><code>read</code>: a <code>DATA_SECTION</code> that defaults to an empty one. This <code>DATA_SECTION</code> describes reads to execute.</li>
<li><code>on_event</code>: a string identifying an event when the whole file is accessed. If not specified, each data is written when it is exposed and the file is opened and closed every time.</li>
<li><code>when</code>: a $-expression specifying a default condition to test before executing the reads and writes of this <code>FILE_DESC</code>. This can be replaced by a more specific condition inside the <code>DATA_SECTION</code>.</li>
<li><code>communicator</code>: a $-expression referencing a MPI communicator to use for HDF5 parallel synchronized reads and writes. It defaults to MPI_COMM_SELF which stands for sequential writes. In case of data-triggered (vs. event-triggered) reads and writes, this can be replaced inside the <code>DATA_SECTION</code>.</li>
<li><code>datasets</code>: a key-value map associating a <a class="el" href="namespacePDI.html">PDI</a> type to string keys. Each string is the name of a dataset to create in the file on first access, with the type described in the value.</li>
</ul>
<h2><a class="anchor" id="autotoc_md37"></a>
`DATA_SECTION`</h2>
<p>The <code>DATA_SECTION</code> describes a set of I/O (read or write) to execute. A data section can take multiple forms:</p><ul>
<li>a list of strings, each being either:<ul>
<li>the name of a <a class="el" href="namespacePDI.html">PDI</a> data to write in a dataset with the same name ( e.g. <code>data</code>, where <code>data</code> is both a <a class="el" href="namespacePDI.html">PDI</a> data and the HDF5 dataset name)</li>
<li>the name of a <a class="el" href="namespacePDI.html">PDI</a> data to write in an attribute of the same name preceded by a <code>#</code> and the name of the dataset or datagroup to which the attribute applies ( e.g. <code>dset::attr</code>, where <code>attr</code> is both a <a class="el" href="namespacePDI.html">PDI</a> data and the HDF5 attribute name applied to the <code>dset</code> dataset)</li>
</ul>
</li>
<li>a key-value map where each key is the name of a <a class="el" href="namespacePDI.html">PDI</a> data to write and the value is either a single <code>DATA_IO_DESC</code> or a list of <code>DATA_IO_DESC</code>s describing the I/O (read or write) to execute.</li>
</ul>
<p>The first case behaves as if each data had its <code>DATA_IO_DESC</code> specified with all default values.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
`DATA_IO_DESC`</h2>
<p>A <code>DATA_IO_DESC</code> is a key-velue map describing one I/O (read or write) to execute. All keys are optional and have default values. The possible values for the keys are as follow:</p><ul>
<li><code>dataset</code>: a $-expression identifying the name of the dataset to access in the file. If not specified this defaults to the name of the data. On writing, if the dataset does not exist in the file and is not specified in the <code>FILE_DESC</code> then a dataset with the same size as the memory selection is automatically created.</li>
<li><code>attribute</code>: a $-expression identifying the path of the attribute to access in the file. The path is specified as a <code>/</code>-separated path to the object on which the attribute is set (a dataset or a datagroup) followed by a <code>#</code> sign and the name of the attribute itself (e.g. <code>group/dset#attr</code>). If the <code>attribute</code> key is specified, then only the <code>when</code> key can also be specified, no other key can be present.</li>
<li><code>size_of</code>: a $-expression identifying the path of the dataset that size should be written to data descriptor.</li>
<li><code>when</code>: a $-expression specifying a condition to test before executing the I/O operation (read or write). This defaults to the value specified in the <code>FILE_DESC</code> if present or to unconditional I/O otherwise.</li>
<li><code>communicator</code>: a $-expression referencing a MPI communicator to use for HDF5 parallel synchronized I/O operation (read or write). Specifying communicator at this level is incompatible with event-triggered (vs. data-triggered) This defaults to the value specified in the <code>FILE_DESC</code> if present or to sequential (MPI_COMM_SELF) I/O otherwise.</li>
<li><code>memory_selection</code>: a <code>SELECTION_DESC</code> specifying the selection of data in memory to read or write. It defaults to selecting the whole data.</li>
<li><code>dataset_selection</code>: a <code>SELECTION_DESC</code> specifying the selection of data in the file data to write or read. This is only valid if the</li>
<li><code>attributes</code>: a key-value map specifying the set of attributes to read from (respectively, write to) the file when the associated dataset is read (respectively, written). Each key is the name of an attribute of the dataset. Each value is a $-expression (evaluated when the dataset is accessed) specifying the value to the attribute.</li>
</ul>
<h2><a class="anchor" id="autotoc_md39"></a>
`SELECTION_DESC`</h2>
<p>A <code>SELECTION_DESC</code> is a key-value map that describes the selection of a subset of data from a larger set. All keys are optional and have default values. The possible values for the keys are as follow:</p><ul>
<li><code>size</code> is either a single $-expression or a list of $-expressions. It describes the size of the selection in each dimension.</li>
<li><code>start</code> is either a single $-expression or a list of $-expressions. It describes the number of point to skip at the beginning in each dimension.</li>
</ul>
<p>Memory selection default values:</p><ul>
<li>If the <code>size</code> is not specified, it defaults to size of the whole data in each dimension.</li>
<li>If the <code>start</code> is not specified it defaults to 0 in all dimensions.</li>
</ul>
<p>Dataset selection default values:</p><ul>
<li>If the <code>size</code> is not specified:<ul>
<li>if the number of dimensions match that of the memory, the size defaults to that of the memory,</li>
<li>otherwise, the size default to the whole dataset.</li>
</ul>
</li>
<li>If the <code>start</code> is not specified it defaults to 0 in all dimensions.</li>
</ul>
<h1><a class="anchor" id="autotoc_md40"></a>
full configuration example</h1>
<div class="fragment"><div class="line">metadata: # small values for which PDI keeps a copy</div><div class="line">  width:   int                    # per proc. width including ghost</div><div class="line">  height:  int                    # per proc. height including ghost</div><div class="line">  pwidth:  int                    # nb proc. in the x dim</div><div class="line">  pheight: int                    # nb proc. in the y dim</div><div class="line">  iter:    int                    # curent iteration id</div><div class="line">  coord:   { type: array, subtype: int, size: 2 } # coordinate of the process as [x, y]</div><div class="line">data:     # values that are not copied by PDI</div><div class="line">  main_field:</div><div class="line">    type: array</div><div class="line">    subtype: double</div><div class="line">    size: [$width, $height]</div><div class="line">plugins:</div><div class="line">  mpi: # loading MPI_Comm predefines (e.g. $MPI_COMM_WORLD)</div><div class="line">  decl_hdf5: # a list of file to write to (can be a single element)</div><div class="line">    file: data${coord[0]}x${coord[1]}.h5 # the file in which to write the data (required)</div><div class="line">    on_event: newiter                    # the event that triggers these actions (default: trigger on data expose)</div><div class="line">    when: &quot;$iter&gt;0 &amp; $iter&lt;11&quot;           # a condition when to actually trigger the actions (default: always true)</div><div class="line">    communicator: $MPI_COMM_SELF         # the MPI communicator used for HDF5 parallel synchronized write (default: $MPI_COMM_SELF, sequential write)</div><div class="line">    datasets:                            # a list of datasets inside the file created on first access</div><div class="line">      data/array: # a dataset name, datasets referenced but not defined are created just big enough to fit the data</div><div class="line">        type: array</div><div class="line">        subtype: double                # type of the data in the dataset</div><div class="line">        size: [10, $width-2, $width-2] # size of the dataset</div><div class="line">    write: # a list or map of data to write (default: empty)</div><div class="line">      main_field: # name of the data, it contains either a list or a single write to execute</div><div class="line">        - dataset: data/array      # a dataset name (default: the data name)</div><div class="line">          when: &quot;$iter&gt;0&amp;$iter&lt;11&quot; # an additional condition when to actually trigger the actions (default: always true)</div><div class="line">          communicator: $MPI_COMM_SELF   # the MPI communicator used for HDF5 parallel synchronized write (default: that of the file)</div><div class="line">          memory_selection:</div><div class="line">            size:  [$width-2, $height-2] # number of elements to transfer in each dimension (default: size of the full data)</div><div class="line">            start: [1, 1]                # coordinate of the start point in memory relative to the shared data (default: 0 in each dimensions)</div><div class="line">          dataset_selection:</div><div class="line">            size:  [1, $width-2, $width-2] # number of elements to transfer in each dimension, must amount to the same number as the memory selection (default: size of memory slab)</div><div class="line">            start: [$iter, 0, 0]           # coordinate of the start point in the file relative to the dataset (default: 0 in each dimensions)</div><div class="line">          attributes:</div><div class="line">            size: ($width-2)*($width-2)</div><div class="line">            width: $width-2</div><div class="line">            height: $width-2</div><div class="line">    read: # a list or map of data to read, similar to write (default: empty)</div><div class="line">      - another_value</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
