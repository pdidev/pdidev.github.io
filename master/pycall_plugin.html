<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: Pycall plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">0.7.0-pre_date-2020-07-30-12_43</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="Installation.html">Installation</a>
	<li><a href="Concepts.html">Core concepts</a>
	<li><a href="First_steps.html">First steps</a>
	<li><a href="Hands_on.html">Tutorial</a>
	<li><a href="PDI_example.html">PDI example</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree reference</a>
	<li><a href="Plugins.html">Plugins</a>
	<li id="gitlab-ribbon"><a href="https://gitlab.maisondelasimulation.fr/pdidev/pdi">Contribute on Gitlab</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('pycall_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Pycall plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Pycall plugin allows calling python scripts from yaml file, that can work either if wanted data was shared or program calls specific event.</p>
<h1><a class="anchor" id="pycall_configuration"></a>
Configuration</h1>
<p>Simple plugin build: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  pycall:           // name of plugin</div><div class="line">    on_event:       // run script on event </div><div class="line">      testing:      // name of an event</div><div class="line">        with:       // data alias</div><div class="line">        exec:       // python code which will be executed when the event is called</div><div class="line">    on_data:        // run script on data share</div><div class="line">      data_name:    // python code which will be executed when data_name is shared</div></div><!-- fragment --><h2><a class="anchor" id="pycall_plugin_tree"></a>
Plugin tree</h2>
<p>The root of plugin configuration (named <code>pycall</code>), is a dictionary that contains the following keys:</p><ul>
<li>on_event</li>
<li>on_data</li>
</ul>
<h2><a class="anchor" id="pycall_on_event"></a>
on_event</h2>
<p>This option allows to execute written python code when specific event is called.</p>
<div class="fragment"><div class="line">data: {a: {type: array, subtype: int, size: 3}}</div><div class="line">plugins:</div><div class="line">  pycall:</div><div class="line">    on_event:</div><div class="line">      testing:</div><div class="line">        with: { a_python: $a }</div><div class="line">        exec: \&quot;print(&#39; * [P] I received    $a =&#39;,a_python); a_python[1]=7; print(&#39; * [P] changed it to $a =&#39;,a_python);\&quot;</div></div><!-- fragment --><p> In this example pycall will run script on <code>testing</code> event. In the next step in <code>with</code> section alias name for data is generated. <code>a</code> will be <code>a_python</code> for execusion of the python code. Finally <code>exec</code> contains python code that will be executed on <code>testing</code> event.</p>
<p>There is also an option to set a list of executions: </p><div class="fragment"><div class="line">data: {a: {type: array, subtype: int, size: 3}}</div><div class="line">plugins:</div><div class="line">  pycall:</div><div class="line">    on_event:</div><div class="line">      testing:</div><div class="line">        - exec: #some_python_script</div><div class="line">          with: { a: $a }</div><div class="line">        - exec: #some_other_python_script</div><div class="line">          with: { b: $a }</div></div><!-- fragment --><h2><a class="anchor" id="pycall_on_data"></a>
on_data</h2>
<p>This option allows to execute written python code when specific data is shared.</p>
<div class="fragment"><div class="line">data: {a: {type: array, subtype: int, size: 3}}</div><div class="line">plugins:</div><div class="line">  pycall:</div><div class="line">    on_data:</div><div class="line">      a: print(&#39; * [P] I received    $a =&#39;,a); a[1]=7; print(&#39; * [P] changed it to $a =&#39;,a);\&quot;</div></div><!-- fragment --><p>The <code>on_data</code> is a dictionary that contains data name with the python script that will be executed on share.</p>
<h1><a class="anchor" id="pycall_ex"></a>
Examples</h1>
<p>Full example of pycall plugin. For siplicity yaml file was included with c code in one file instead of creating separate files.</p>
<p>Yaml file named your_file: </p><div class="fragment"><div class="line">logging: trace                                 </div><div class="line">    data: {a: {type: array, subtype: int, size: 3}}</div><div class="line">    plugins:</div><div class="line">      pycall:</div><div class="line">        on_event:</div><div class="line">          testing:</div><div class="line">            with: { a_python: $a }</div><div class="line">            exec: \&quot;print(&#39; * [P] I received    $a =&#39;,a_python); a_python[1]=7; print(&#39; * [P] changed it to $a =&#39;,a_python);\&quot;</div></div><!-- fragment --><p>C++ code: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> a[3] = {1, 2, 3};</div><div class="line"></div><div class="line">printf(<span class="stringliteral">&quot; * [C] starting with $a = [%d %d %d]\n&quot;</span>, a[0], a[1], a[2]);</div><div class="line"></div><div class="line"><a class="code" href="group__annotation.html#ga34e34cede8627c47c07e6ede997e37fe">PDI_share</a>(<span class="stringliteral">&quot;a&quot;</span>, a, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a5cf752cb5cd43b4ae3d7590af61c9939">PDI_INOUT</a>);</div><div class="line"><a class="code" href="group__annotation.html#gab21d59fd8d6532f6b8d7a4ac69a2388b">PDI_event</a>(<span class="stringliteral">&quot;testing&quot;</span>);</div><div class="line"><a class="code" href="group__annotation.html#gabf58b7c146cbf7e3341245f60cec0f7e">PDI_reclaim</a>(<span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"></div><div class="line">printf(<span class="stringliteral">&quot; * [C] now I see     $a = [%d %d %d]\n&quot;</span>, a[0], a[1], a[2]);</div></div><!-- fragment --><p> Output from the program: </p><div class="fragment"><div class="line"> * [C] starting with $a = [1 2 3]</div><div class="line">[PDI][13:51:26] *** trace: Sharing `a&#39; Ref with rights: R = true, W = true</div><div class="line">[PDI][13:51:26] *** trace: Calling `a&#39; share. Callbacks to call: 0</div><div class="line">[PDI][13:51:26] *** trace: Calling `testing&#39; event. Callbacks to call: 1</div><div class="line"> * [P] I received    $a = [1 2 3]</div><div class="line"> * [P] changed it to $a = [1 7 3]</div><div class="line"> * [C] now I see     $a = [1 7 3]</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
