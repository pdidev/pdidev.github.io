<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: The Decl&#39;NetCDF plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">1.2.0-alpha.2021-03-26.f44d740</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="Installation.html">Installation</a>
	<li><a href="PDI_usage.html">PDI usage</a>
	<li><a href="Concepts.html">Core concepts</a>
	<li><a href="First_steps.html">First steps</a>
	<li><a href="Hands_on.html">Tutorial</a>
	<li><a href="PDI_example.html">PDI example</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree</a>
	<li><a href="Plugins.html">Plugins</a>
	<li id="gitlab-ribbon"><a href="https://gitlab.maisondelasimulation.fr/pdidev/pdi">Contribute on Gitlab</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('Decl_NetCDF_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The Decl'NetCDF plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Decl'NetCDF plugin was created to read from and write to NetCDF files in a declarative way.</p>
<p>Decl'NetCDF plugin allows you to:</p><ol type="1">
<li>Read/write data as NetCDF variables from/to NetCDF file.</li>
<li>Define groups in the NetCDF file. Groups can be nested.</li>
<li>Read/write variables and groups attributes. <b>Automatically read and written when openning the file.</b></li>
<li>Execute input/output operations on event.</li>
<li>Execute input/output operations on data share (when the event is not defined).</li>
<li>Define <code>UNLIMITED</code> dimension and dimensions names.</li>
<li>Read/write only part of NetCDF variable by hyperslab definition.</li>
<li>Read/write in parallel mode using MPI.</li>
</ol>
<h1><a class="anchor" id="decl_netcdf_configuration"></a>
Configuration elements</h1>
<p>The root of Decl'NetCDF plugin configuration (named <code>decl_netcdf</code>), is a dictionary or a list of dictionaries that contains the following subtrees: </p><table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value </th><th align="left"></th></tr>
<tr>
<td align="left"><code>file</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_file">file subtree</a> </td><td align="left">*mandatory* </td></tr>
<tr>
<td align="left"><code>communicator</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_comm">communicator subtree</a> </td><td align="left">*optional* </td></tr>
<tr>
<td align="left"><code>on_event</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_on_event">on_event subtree</a> </td><td align="left">*optional* </td></tr>
<tr>
<td align="left"><code>groups</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_groups">groups subtree</a> </td><td align="left">*optional* </td></tr>
<tr>
<td align="left"><code>variables</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_variables">variables subtree</a> </td><td align="left">*optional* </td></tr>
<tr>
<td align="left"><code>write</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_write">write subtree</a> </td><td align="left">*optional* </td></tr>
<tr>
<td align="left"><code>read</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_read">read subtree</a> </td><td align="left">*optional* </td></tr>
</table>
<p>Configuration examples: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;&quot;file_name.nc&quot;&quot;</div><div class="line">    write: ...</div></div><!-- fragment --><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    - file: &quot;&quot;file_name.nc&quot;&quot;</div><div class="line">      write: ...</div><div class="line">    - file: &quot;file_name_2.nc&quot;</div><div class="line">      write: ...</div><div class="line">    - file: &quot;&quot;file_name.nc&quot;&quot;</div><div class="line">      read: ...</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_file"></a>
file subtree</h2>
<p>Defines name (path) of the input/output file.</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>file</code></td><td align="left">string containing filename (can have <code>$-expressions</code>) </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name_${i}.nc&quot;</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_comm"></a>
communicator subtree</h2>
<dl class="section warning"><dt>Warning</dt><dd>Feature not tested yet</dd></dl>
<p>Enables parallel NetCDF input/output. Defines communicator to use on read/write (all processes must have the same communicator and filename).</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>communicator</code></td><td align="left"><code>$-expression</code> to valid MPI_comm </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;&quot;file_name.nc&quot;&quot;</div><div class="line">    communicator: $MPI_COMM_WORLD</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_on_event"></a>
on_event subtree</h2>
<p>Defines on which events the plugin reads/writes data from/to NetCDF file. The value can be either single event name or the array of events names (both examples presented below).</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>on_event</code></td><td align="left">string or array of string that cointain event names </td></tr>
</table>
<p>Configuration examples: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    on_event: &quot;event&quot;</div></div><!-- fragment --><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    on_event: [&quot;event_1&quot;, &quot;event_2&quot;]</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_when"></a>
when subtree</h2>
<p>Defines the condition on which plugin will execute input/output operation on the file.</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>when</code></td><td align="left"><code>$-expression</code> condition evalueated to boolean value </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    when: &quot;$i &lt; 10&quot;</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_groups"></a>
groups subtree</h2>
<p>Defines groups in the NetCDF file. Mainly used to read/write attributes values of the groups.</p>
<p>If group won't have any attributes, this subtree can be omitted. Decl'NetCDF plugin will create group by default for every variable.</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>groups</code></td><td align="left">Map of <a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_groups_name">group name subtree</a> </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    groups:</div><div class="line">      group1:</div><div class="line">        attributes:</div><div class="line">          attr1: </div><div class="line">            value: $value1</div><div class="line">          attr2: </div><div class="line">            value: $value2</div><div class="line">      group1/group2:</div><div class="line">        attributes:</div><div class="line">          attr1: </div><div class="line">            value: $value3</div><div class="line">          attr2: </div><div class="line">            value: $value4</div></div><!-- fragment --><h3><a class="anchor" id="decl_netcdf_groups_name"></a>
group name subtree</h3>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left">name (path) of the group </td><td align="left">Map with <code>attribute</code> key with value as map of <a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_attr">attribute subtree</a> </td></tr>
</table>
<h2><a class="anchor" id="decl_netcdf_variables"></a>
variables subtree</h2>
<p>Defines variables in the NetCDF file. Mainly used to define dimensions names and read/write attributes of the variable.</p>
<ol type="1">
<li>If no dimensions names are defined, the plugin will give them arbitrary names.</li>
<li>If the data type of variable differs from the one in descriptor this subtree is mandatory. It also allows to define <code>UNLIMITED</code> dimension (size of dimension must be then set to <code>0</code>).</li>
<li>If the variable is in group it has to be define in the variable name (<code>/</code> group notation: <code>group_name/varaibale_name</code>)</li>
<li>This subtree can be omitted. In this case, the name of NetCDF variable will be the same as the name of the descriptor and have the same type and no attributes.</li>
</ol>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left">variable path </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_variables_value">variable definition subtree</a> </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    variables:</div><div class="line">      group1/group2/variable_name:</div><div class="line">        type: array</div><div class="line">        subtype: double</div><div class="line">        size: [0, $value, $value] # 0 -&gt; UNLIMITED dimension</div><div class="line">        dimensions: [&quot;time&quot;, &quot;height&quot;, &quot;width&quot;]</div><div class="line">        attributes:</div><div class="line">          attr1: $value</div></div><!-- fragment --><h3><a class="anchor" id="decl_netcdf_variables_value"></a>
variable definition subtree</h3>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value </th><th></th></tr>
<tr>
<td align="left">type </td><td align="left">type of variable (defined the same way as other types in PDI)</td><td>*optional* </td></tr>
<tr>
<td align="left">dimensions </td><td align="left">array of dimensions names of variable </td><td>*optional* </td></tr>
<tr>
<td align="left">attributes </td><td align="left">Map of <a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_attr">attribute subtree</a> </td><td>*optional* </td></tr>
</table>
<h3><a class="anchor" id="decl_netcdf_attr"></a>
attribute subtree</h3>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left">attribute name</td><td align="left"><code>$-expression</code> value to be written as attribute </td></tr>
</table>
<h2><a class="anchor" id="decl_netcdf_write"></a>
write subtree</h2>
<p>The <code>write</code> subtree can have 2 definitions:</p>
<ol type="1">
<li><p class="startli">Just a name of descriptor to write or the list of descriptors names to write to file. In this case the name of NetCDF variable will be the same as the name of the descriptor and have the same type and no attributes.</p>
<p class="startli">Configuration examples: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    write: data_name</div><div class="line">#-------------------------------------</div><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    write: [data_name_1, data_name_2]</div></div><!-- fragment --></li>
<li>Dictionary, with key as descriptor name and value as following subtree:</li>
</ol>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value </th><th></th></tr>
<tr>
<td align="left"><code>when</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_io_when">read/write when subtree</a> </td><td>*optional* </td></tr>
<tr>
<td align="left"><code>variable</code> </td><td align="left">variable name to write (may be defined in <a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_variables">variables subtree</a>)</td><td>*optional* </td></tr>
<tr>
<td align="left"><code>variable_selection</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_var_selection">subtree</a> </td><td>*optional* </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">data:</div><div class="line">  int_submatrix_11:</div><div class="line">    type: array</div><div class="line">    subtype: int</div><div class="line">    size: [4, 4]</div><div class="line"></div><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    variables:</div><div class="line">        integer_matrix:</div><div class="line">          type: array</div><div class="line">          subtype: int</div><div class="line">          size: [8, 8]</div><div class="line">          dimensions: [&quot;height&quot;, &quot;width&quot;]</div><div class="line">    write:</div><div class="line">      int_submatrix_11:</div><div class="line">        when: $i &lt; 10</div><div class="line">        variable: integer_matrix</div><div class="line">        variable_selection:  # select bottom-left submatrix 4x4</div><div class="line">          start: [4, 4]</div><div class="line">          subsize: [4, 4]</div></div><!-- fragment --><h3><a class="anchor" id="decl_netcdf_var_selection"></a>
subtree</h3>
<p>Defines the part of file NetCDF variable where from read/to write the data. The hyperslab will be created from given <code>start</code> and <code>subsize</code> (<code>count</code>) lists.</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value </th><th></th></tr>
<tr>
<td align="left"><code>start</code> </td><td align="left">list specifying start index for each dimension </td><td>*optional* </td></tr>
<tr>
<td align="left"><code>subsize</code> </td><td align="left">list specifying count for each dimension </td><td>*optional* </td></tr>
</table>
<h3><a class="anchor" id="decl_netcdf_io_when"></a>
read/write when subtree</h3>
<p>Defines the condition on which plugin will read/write specific variable.</p>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>when</code></td><td align="left"><code>$-expression</code> condition evalueated to boolean value </td></tr>
</table>
<h2><a class="anchor" id="decl_netcdf_read"></a>
read subtree</h2>
<p>The <code>read</code> subtree can have 2 definitions:</p>
<ol type="1">
<li><p class="startli">Just a name of descriptor to read or the list of descriptors names to read to file. In this case the name of NetCDF variable must be the same as the name of the descriptor and have the same type and no attributes will be read.</p>
<p class="startli">Configuration examples: </p><div class="fragment"><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    read: data_name</div><div class="line">#-------------------------------------</div><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    read: [data_name_1, data_name_2]</div></div><!-- fragment --></li>
<li>Dictionary, with key as descriptor name and value as following subtree:</li>
</ol>
<table class="doxtable">
<tr>
<th align="left">key </th><th align="left">value </th><th></th></tr>
<tr>
<td align="left"><code>when</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_io_when">read/write when subtree</a> </td><td>*optional* </td></tr>
<tr>
<td align="left"><code>variable</code> </td><td align="left">variable name to read (may be defined in <a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_variables">variables subtree</a>) </td><td>*optional* </td></tr>
<tr>
<td align="left"><code>variable_selection</code> </td><td align="left"><a class="el" href="Decl_NetCDF_plugin.html#decl_netcdf_var_selection">subtree</a> </td><td>*optional* </td></tr>
</table>
<p>Configuration example: </p><div class="fragment"><div class="line">data:</div><div class="line">  int_submatrix_11:</div><div class="line">    type: array</div><div class="line">    subtype: int</div><div class="line">    size: [4, 4]</div><div class="line"></div><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    file: &quot;file_name.nc&quot;</div><div class="line">    variables:</div><div class="line">        integer_matrix:</div><div class="line">          type: array</div><div class="line">          subtype: int</div><div class="line">          size: [8, 8]</div><div class="line">    read:</div><div class="line">      int_submatrix_11:</div><div class="line">        when: $i &lt; 10</div><div class="line">        variable: integer_matrix</div><div class="line">        variable_selection:  # select bottom-left submatrix 4x4</div><div class="line">          start: [4, 4]</div><div class="line">          subsize: [4, 4]</div></div><!-- fragment --><h2><a class="anchor" id="decl_netcdf_full_config"></a>
Full yaml example</h2>
<div class="fragment"><div class="line">metadata:</div><div class="line">  var_attr: float</div><div class="line">  group1_attr: float</div><div class="line">  group1_data_attr: float</div><div class="line">data:</div><div class="line">  int_submatrix_top:</div><div class="line">    type: array</div><div class="line">    subtype: int</div><div class="line">    size: [4, 8]</div><div class="line">  int_submatrix_bottom:</div><div class="line">    type: array</div><div class="line">    subtype: int</div><div class="line">    size: [4, 8]</div><div class="line">plugins:</div><div class="line">  decl_netcdf:</div><div class="line">    - file: &quot;example.nc&quot;</div><div class="line">      on_event: &quot;write&quot;</div><div class="line">      groups:</div><div class="line">        group_1:</div><div class="line">          attributes:</div><div class="line">            some_attr: $group1_attr</div><div class="line">        group_1/data:</div><div class="line">          attributes:</div><div class="line">            some_attr: $group1_data_attr</div><div class="line">      variables:</div><div class="line">        group_1/data/int_matrix:</div><div class="line">          type: array</div><div class="line">          subtype: int</div><div class="line">          size: [8, 8]</div><div class="line">          dimensions: [&quot;height&quot;, &quot;width&quot;]</div><div class="line">          attributes:</div><div class="line">            custom_attr: $var_attr</div><div class="line">      write: </div><div class="line">        int_submatrix_top:</div><div class="line">          variable: group_1/data/int_matrix</div><div class="line">          variable_selection:</div><div class="line">            start: [0, 0]</div><div class="line">            subsize: [4, 8]</div><div class="line">        int_submatrix_bottom:</div><div class="line">          variable: group_1/data/int_matrix</div><div class="line">          variable_selection:</div><div class="line">            start: [4, 0]</div><div class="line">            subsize: [4, 8]</div><div class="line">    - file: &quot;example.nc&quot;</div><div class="line">      on_event: &quot;read&quot;</div><div class="line">      groups:</div><div class="line">        group_1/data:</div><div class="line">          attributes:</div><div class="line">            some_attr: $custom_attr</div><div class="line">      variables:</div><div class="line">        group_1/data/int_matrix:</div><div class="line">          type: array</div><div class="line">          subtype: int</div><div class="line">          size: [8, 8]</div><div class="line">          dimensions: [&quot;height&quot;, &quot;width&quot;]</div><div class="line">          attributes:</div><div class="line">            custom_attr: $var_attr</div><div class="line">      read: </div><div class="line">        int_submatrix_top:</div><div class="line">          variable: group_1/data/int_matrix</div><div class="line">          variable_selection:</div><div class="line">            start: [0, 0]</div><div class="line">            subsize: [4, 8]</div><div class="line">        int_submatrix_bottom:</div><div class="line">          variable: group_1/data/int_matrix</div><div class="line">          variable_selection:</div><div class="line">            start: [4, 0]</div><div class="line">            subsize: [4, 8]</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
