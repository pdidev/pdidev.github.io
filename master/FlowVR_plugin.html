<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: The FlowVR plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">0.7.0-pre_date-2020-11-25-08_39</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="Installation.html">Installation</a>
	<li><a href="Concepts.html">Core concepts</a>
	<li><a href="First_steps.html">First steps</a>
	<li><a href="Hands_on.html">Tutorial</a>
	<li><a href="PDI_example.html">PDI example</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree reference</a>
	<li><a href="Plugins.html">Plugins</a>
	<li id="gitlab-ribbon"><a href="https://gitlab.maisondelasimulation.fr/pdidev/pdi">Contribute on Gitlab</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('FlowVR_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">The FlowVR plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <a href="http://flowvr.sourceforge.net">FlowVR</a> plugin lets you write FlowVR modules without knowing any specific FlowVR API calls. Properly created PDI configuration file allows you to care only about proper input/output calls, but this plugin does not support the full FlowVR feature set.</p>
<h1><a class="anchor" id="configuration"></a>
Configuration elements</h1>
<h2><a class="anchor" id="flowvr_tree"></a>
FlowVR plugin tree</h2>
<p>The root of FlowVR plugin configuration (named <code>flowvr</code>), is a dictionary that contains the following keys:</p><ul>
<li><a class="el" href="FlowVR_plugin.html#component_node">component</a></li>
<li><a class="el" href="FlowVR_plugin.html#wait_on_data_node">wait_on_data</a> (<em>recommended</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#wait_on_node">wait_on</a> (<em>optional</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#status_node">status</a> (<em>optional</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#abort_on_node">abort_on</a> (<em>optional</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#init_on_node">init_on</a> (<em>optional</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#input_ports">input_ports</a> (<em>optional</em>)</li>
<li><a class="el" href="FlowVR_plugin.html#output_ports">output_ports</a> (<em>optional</em>)</li>
</ul>
<h3><a class="anchor" id="component_node"></a>
component</h3>
<p>For now only available component is <code>module</code>, but this can be expanded to <code>filter</code> and <code>synchronizer</code> in the future. Configuration example:</p>
<div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div></div><!-- fragment --><h3><a class="anchor" id="wait_on_data_node"></a>
wait_on_data</h3>
<p>The plugin will call <code>wait</code> funciton every time given descriptors will be shared with <code>PDI_IN</code> access direction. This descriptor must be an integer type and the status returned from this call will be written as a response. Configuration example:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div></div><!-- fragment --><h3><a class="anchor" id="wait_on_node"></a>
wait_on</h3>
<p>Defines on which events the plugin calls the <code>wait</code> function. The value can be either single event name or the array of events names (both examples presented below). This method of calling <code>wait</code> should be avoided if possible, because it's not returning the wait status. Configuration examples:</p>
<div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on: &quot;wait_event&quot;</div></div><!-- fragment --><div class="fragment"><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on: [&quot;wait_event_1&quot;, &quot;wait_event_2&quot;]</div></div><!-- fragment --><h3><a class="anchor" id="status_node"></a>
status</h3>
<p>PDI will copy the status of the module to the given descriptor. The same as the <code>wait_on</code> it can be a single name or an array of names. Configuration example:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  status_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    status: status_desc</div></div><!-- fragment --><h3><a class="anchor" id="abort_on_node"></a>
abort_on</h3>
<p>Defines on which events the plugin calls the <code>abort</code> function which will stop the flowvr application. The value can be either single event name or the array of events names. Configuration examples:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">   component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    abort_on: &quot;abort_event&quot;</div></div><!-- fragment --><h3><a class="anchor" id="init_on_node"></a>
init_on</h3>
<p>Defining this subtree tells PDI that the plugin should be initialized not on <code>PDI_init</code>, but on given event.</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">   component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    init_on: &quot;init_event&quot;</div></div><!-- fragment --><h3><a class="anchor" id="parallel_node"></a>
parallel</h3>
<p>This node can be for reading rank and size of the world, but also can be for setting this values. <code>get_rank</code> will copy process's rank to given descriptor on share, <code>get_size</code> will save the world size the same way. Example: </p><div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  rank_desc: int</div><div class="line">  size_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    parallel:</div><div class="line">      get_rank: rank_desc</div><div class="line">      get_size: size_desc</div></div><!-- fragment --><p>Values (use <code>$</code> expression) from descriptors defined in <code>set_rank</code> and <code>set_size</code> will be passed to flowvr and set the environment. Setting this parameters must occur before plugin initialization. For this you need to use <code>init_on</code> event and call this event after setting rank and size.</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_desc: int</div><div class="line">  rank_desc: int</div><div class="line">  size_desc: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    component: module</div><div class="line">    wait_on_data: wait_desc</div><div class="line">    parallel:</div><div class="line">      set_rank: $rank_desc</div><div class="line">      set_size: $size_desc</div></div><!-- fragment --><h3><a class="anchor" id="several_modules"></a>
Several modules</h3>
<p>Single program can run several modules at once. To make it work just create array of modules in <code>flowvr</code> tree. Configuration example:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  wait_1: int</div><div class="line">  wait_2: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  - component: module</div><div class="line">    wait_on_data: wait_1</div><div class="line">    ...</div><div class="line">  - component: module</div><div class="line">    wait_on_data: wait_2</div><div class="line">    ...</div></div><!-- fragment --><h2><a class="anchor" id="ports"></a>
Ports</h2>
<h3><a class="anchor" id="input_ports"></a>
input_ports</h3>
<p>Input ports are defined in <code>input_ports</code> tree. Each port is defined by name and <a class="el" href="FlowVR_plugin.html#message">Message</a> it will receive. You can add <code>event_port: true</code> to define this as event port (non-blocking).</p>
<div class="fragment"><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  input_ports:</div><div class="line">    port_name_1:</div><div class="line">      ...</div><div class="line">    port_name_2:</div><div class="line">      event_port: true</div><div class="line">      ...</div></div><!-- fragment --><h3><a class="anchor" id="output_ports"></a>
output_ports</h3>
<p>Output ports are defined in <code>output_ports</code> tree. Each port is defined by name and <a class="el" href="FlowVR_plugin.html#message">Message</a> it will send. </p><div class="fragment"><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    port_name_1: ...</div><div class="line">    port_name_2: ...</div></div><!-- fragment --><h2><a class="anchor" id="message"></a>
Message</h2>
<p>Flowvr message consists of payload and stamps. The <code>payload</code> is defined by user by a specific key in port definition:</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">message type  </th></tr>
<tr>
<td align="left">"data"</td><td align="left"><a class="el" href="FlowVR_plugin.html#data_payload">Data payload</a> </td></tr>
<tr>
<td align="left">"chunks"</td><td align="left"><a class="el" href="FlowVR_plugin.html#chunks_payload">Chunk payload</a> </td></tr>
<tr>
<td align="left">"event_button"</td><td align="left"><a class="el" href="FlowVR_plugin.html#button_payload">Event button payload</a> </td></tr>
<tr>
<td align="left">"event_mouse"</td><td align="left"><a class="el" href="FlowVR_plugin.html#mouse_payload">Event mouse payload</a> </td></tr>
</table>
<p>If none of the message type will be given, plugin will create a STAMP port (message has no payload). <code>stamps</code> are described in <a class="el" href="FlowVR_plugin.html#stamp">Stamp</a> section.</p>
<h3><a class="anchor" id="data_payload"></a>
Data payload</h3>
<p>Requires <code>data</code> key in a port tree. This configuration means that module will send simple buffer. The plugin doesn't know the type of sending data. The value of <code>data</code> key is the name of the descriptor where:</p>
<ul>
<li>for input port - FlowVR plugin will write to received data</li>
<li>for output port - FlowVR plugin will read from to send data</li>
</ul>
<p>Example of <code>data</code> in output port:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  data_desc: {type: array, subtype: int, size: 32}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      data: data_desc</div></div><!-- fragment --><p>The user can not always predict how many data will receive. In this case <code>size</code> node type must be a name of metadata where to write the size of received payload. This metadata will hold the size of received array. The <code>size</code> property of descriptor should be divided by size of single element. Example of receiving unknown payload size:</p>
<div class="fragment"><div class="line">metadata:</div><div class="line">  received_size : int</div><div class="line">data:</div><div class="line">  data_descriptor_name: {type: array, subtype: int, size: $received_size/4}</div><div class="line"></div><div class="line">plugins:</div><div class="line">  flowvr:</div><div class="line">    ...</div><div class="line">    input_ports:</div><div class="line">      some_port_name:</div><div class="line">        data: data_descriptor_name</div><div class="line">        size: received_size</div></div><!-- fragment --><p>In case that you want to send only a part of the data from descriptor you can specify it in <code>copy_data_selection</code> tree defining datatype the same way as for descriptors. Simple example:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  data_descriptor_name:  {type: array, subtype: int, size: [32, 32]}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      data: data_descriptor_name</div><div class="line">      copy_data_selection:</div><div class="line">        type: array</div><div class="line">        subtype: int</div><div class="line">        size: [32, 32]</div><div class="line">        subsize: [30, 30]</div><div class="line">        start: [1, 1]</div></div><!-- fragment --><h2><a class="anchor" id="chunks_payload"></a>
Chunk payload</h2>
<p>Requires <code>chunks</code> key in a port tree. This configuration means that module will send several buffers in one payload. Value of the <code>chunks</code> key is the list of <a class="el" href="FlowVR_plugin.html#data_payload">Data payload</a>. </p><hr/>
<p> WARNING</p>
<p>After each wait, the first access to the any descriptor (that belongs to the chunks) will allocate the memory for the all descriptors. This means that all sizes (if stored as metadata) should be set before first access to any of the descriptors. </p><hr/>
<div class="fragment"><div class="line">data:</div><div class="line">  chunk_1_name: int</div><div class="line">  chunk_2_name: {type: array, subtype: char, size: 255}</div><div class="line">  chunk_3_name: float</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      chunks:</div><div class="line">        - data: chunk_1_name</div><div class="line">        - data: chunk_2_name</div><div class="line">        - data: chunk_3_name</div></div><!-- fragment --><h2><a class="anchor" id="button_payload"></a>
Event button payload</h2>
<p>Requires <code>event_button</code> key in a port tree. The payload holds the values of the keyboard keys pressed during iteration.</p>
<p>The full list of predefined keys:</p>
<table class="doxtable">
<tr>
<th align="left">key in configuration</th><th align="left">key on keyboard  </th></tr>
<tr>
<td align="left">KEY_F1</td><td align="left">F1 </td></tr>
<tr>
<td align="left">KEY_F2</td><td align="left">F2 </td></tr>
<tr>
<td align="left">KEY_F3</td><td align="left">F3 </td></tr>
<tr>
<td align="left">KEY_F4</td><td align="left">F4 </td></tr>
<tr>
<td align="left">KEY_F5</td><td align="left">F5 </td></tr>
<tr>
<td align="left">KEY_F6</td><td align="left">F6 </td></tr>
<tr>
<td align="left">KEY_F7</td><td align="left">F7 </td></tr>
<tr>
<td align="left">KEY_F8</td><td align="left">F8 </td></tr>
<tr>
<td align="left">KEY_F9</td><td align="left">F9 </td></tr>
<tr>
<td align="left">KEY_F10</td><td align="left">F10 </td></tr>
<tr>
<td align="left">KEY_F11</td><td align="left">F11 </td></tr>
<tr>
<td align="left">KEY_F12</td><td align="left">F12 </td></tr>
<tr>
<td align="left">KEY_UP</td><td align="left">Up Arrow </td></tr>
<tr>
<td align="left">KEY_DOWN</td><td align="left">Down Arrow </td></tr>
<tr>
<td align="left">KEY_LEFT</td><td align="left">Left Arrow </td></tr>
<tr>
<td align="left">KEY_RIGHT</td><td align="left">Right Arrow </td></tr>
<tr>
<td align="left">KEY_PAGE_UP</td><td align="left">Page Up </td></tr>
<tr>
<td align="left">KEY_PAGE_DOWN</td><td align="left">Page Down </td></tr>
<tr>
<td align="left">KEY_HOME</td><td align="left">Home </td></tr>
<tr>
<td align="left">KEY_END</td><td align="left">End </td></tr>
<tr>
<td align="left">KEY_INSERT</td><td align="left">Insert </td></tr>
</table>
<p>Value for each key in configuration is a descriptor of integer type. You need to make sure that you are setting this descriptors with correct values on each iteration. Example of configuration with arrow buttons:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line">  left: int</div><div class="line">  right: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      event_button:</div><div class="line">        KEY_UP: up</div><div class="line">        KEY_DOWN: down</div><div class="line">        KEY_LEFT: left</div><div class="line">        KEY_RIGHT: right</div></div><!-- fragment --><h2><a class="anchor" id="mouse_payload"></a>
Event mouse payload</h2>
<p>Requires <code>event_mouse</code> key in a port tree. The payload holds the values of the mouse keys pressed and cursor position during iteration. The button state is saved in descriptors of integer type and a cursor position in an array of 2 floats.</p>
<p>Available keys in <code>event_mouse</code> tree: </p><table class="doxtable">
<tr>
<th align="left">key</th><th align="left">description  </th></tr>
<tr>
<td align="left">POS_XY</td><td align="left">cursor position </td></tr>
<tr>
<td align="left">LEFT_BUTTON</td><td align="left">left mouse button </td></tr>
<tr>
<td align="left">MIDDLE_BUTTON</td><td align="left">middle mouse button </td></tr>
<tr>
<td align="left">RIGHT_BUTTON</td><td align="left">right mouse button </td></tr>
</table>
<p>Example of configuration with all keys defined:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line">  right_button: int</div><div class="line">  middle_button: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      event_mouse:</div><div class="line">        POS_XY: pos_xy</div><div class="line">        LEFT_BUTTON: left_button</div><div class="line">        RIGHT_BUTTON: right_button</div><div class="line">        MIDDLE_BUTTON: middle_button</div></div><!-- fragment --><h2><a class="anchor" id="stamp"></a>
Stamp</h2>
<p>The <code>stamps</code> key must be defined in a port tree. The value of <code>stamps</code> is simply a map with the stamp name and descriptor name. The given descriptor must have a valid PDI type, limited to:</p>
<ul>
<li><code>int</code></li>
<li><code>float</code></li>
<li><code>array of ints</code></li>
<li><code>array of floats</code></li>
<li><code>array of chars</code></li>
</ul>
<p>Example of message with <a class="el" href="FlowVR_plugin.html#data_payload">Data payload</a> and 2 stamps:</p>
<div class="fragment"><div class="line">data:</div><div class="line">  data_desc: {type: array, subtype: int, size: 256}</div><div class="line">  stamp_1_desc: int</div><div class="line">  stamp_2_desc: {type: array, subtype: float, size: 2}</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      data: data_desc</div><div class="line">      stamps:</div><div class="line">        stamp_1_name: stamp_1_desc</div><div class="line">        stamp_2_name: stamp_2_desc</div></div><!-- fragment --><p>For output port stamp can be also define as an expression, but stamp will need type definition in this case. Example of expression stamp:</p>
<div class="fragment"><div class="line">metadata:</div><div class="line">  value_desc: int</div><div class="line"></div><div class="line">flowvr:</div><div class="line">  ...</div><div class="line">  output_ports:</div><div class="line">    some_port_name:</div><div class="line">      stamps:</div><div class="line">        stamp_name:</div><div class="line">          type: int</div><div class="line">          expression: ($value_desc/2) * 3</div></div><!-- fragment --><p>For now only int and string stamps are supported as expression.</p>
<h1><a class="anchor" id="c_api"></a>
Reading and writing data examples</h1>
<p>FlowVR plugin uses 2 ways to handle data reading and writing:</p>
<ol type="1">
<li>Access the shared memory - the fastest way, user operates on flowvr shared memory.</li>
<li>Copy the data from shared memory to descriptor - needs the data copy (convenient for small messages or sparse data types).</li>
</ol>
<h2><a class="anchor" id="read_shared"></a>
Read data from FlowVR message by access the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text_shr: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        data: text_shr</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span>* text_shr;</div><div class="line"><a class="code" href="group__annotation.html#ga8dcd0c81d7697ea473a55bd57efb717d">PDI_access</a>(<span class="stringliteral">&quot;text_shr&quot;</span>, (<span class="keywordtype">void</span>**)&amp;text_shr, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="comment">// do something with text_shr or copy data to local buffer</span></div><div class="line"></div><div class="line"><a class="code" href="group__annotation.html#ga001117ae897dd4e4a25c312b5d00c43a">PDI_release</a>(<span class="stringliteral">&quot;text_shr&quot;</span>); <span class="comment">// really important to release descriptors</span></div></div><!-- fragment --><h2><a class="anchor" id="write_shared"></a>
Write data from FlowVR message by access the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text_shr: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: text_shr</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span>* text_shr;</div><div class="line"><a class="code" href="group__annotation.html#ga8dcd0c81d7697ea473a55bd57efb717d">PDI_access</a>(<span class="stringliteral">&quot;text_shr&quot;</span>, (<span class="keywordtype">void</span>**)&amp;text_shr, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="comment">// do something with text_shr or copy data from local buffer</span></div><div class="line"></div><div class="line"><a class="code" href="group__annotation.html#ga001117ae897dd4e4a25c312b5d00c43a">PDI_release</a>(<span class="stringliteral">&quot;text_shr&quot;</span>); <span class="comment">// really important to release descriptors</span></div></div><!-- fragment --><h2><a class="anchor" id="read_copy"></a>
Read data from FlowVR message by copy from the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        data: text</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span> text[4];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;text&quot;</span>, text, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="write_copy"></a>
Write data to FlowVR message by copy to the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  text: {type: array, subtype: char, size: 4}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: text</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">char</span> text[4];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;text&quot;</span>, text, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="wrtie_sparse"></a>
Write data to FlowVR message by copy the subset of data to the shared memory</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  my_array: {type: array, subtype: int, size: [20, 20]}</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        data: my_array</div><div class="line">        copy_data_selection: {type: array, subtype: int, size: [20, 20], subsize: [10, 10], start: [0, 0]}</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> my_array[400];</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;my_array&quot;</span>, my_array, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>); <span class="comment">// copies only 100 elements</span></div></div><!-- fragment --><h1><a class="anchor" id="Reading"></a>
and writing stamps examples</h1>
<p>Stamps are always copied from descriptor to flowvr message.</p>
<h2><a class="anchor" id="read_stamp"></a>
Read stamp from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  stamp_it: int</div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      text:</div><div class="line">        stamps:</div><div class="line">          it: stamp_it</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> stamp_it = some_value;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;stamp_it&quot;</span>, &amp;stamp_it, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="write_stamp"></a>
Write stamp from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  user_stamp: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      text:</div><div class="line">        stamps:</div><div class="line">          user_defined_stamp: user_stamp</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> user_stamp = some_value;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;user_stamp&quot;</span>, &amp;user_stamp, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h1><a class="anchor" id="mouse_button_event"></a>
Reading and writing mouse and button event examples</h1>
<h2><a class="anchor" id="write_mouse"></a>
Write mouse event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      keysOut:</div><div class="line">        event_mouse:</div><div class="line">          POS_XY: pos_xy</div><div class="line">          LEFT_BUTTON: left_button</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">float</span> pos_xy[2] = {x_pos, y_pos};</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;pos_xy&quot;</span>, &amp;pos_xy, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> left_button = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;left_button&quot;</span>, &amp;left_button, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="read_mouse"></a>
Read mouse event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  pos_xy: {type: array, subtype: float, size: 2}</div><div class="line">  left_button: int</div><div class="line"></div><div class="line">...</div><div class="line">input_ports:</div><div class="line">  keysIn:</div><div class="line">    event_mouse:</div><div class="line">      POS_XY: pos_xy</div><div class="line">      LEFT_BUTTON: left_button</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">float</span> pos_xy;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;pos_xy&quot;</span>, &amp;pos_xy, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> left_button;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;left_button&quot;</span>, &amp;left_button, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h2><a class="anchor" id="write_button"></a>
Write button event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line"></div><div class="line">...</div><div class="line">    output_ports:</div><div class="line">      keysOut:</div><div class="line">        event_button:</div><div class="line">          KEY_UP: up</div><div class="line">          KEY_DOWN: down</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> up_state = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;up&quot;</span>, &amp;up_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> down_state = 1;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;down&quot;</span>, &amp;down_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a49ed5399cbc2fca8085867ea04d01b6e">PDI_OUT</a>);</div></div><!-- fragment --><h2><a class="anchor" id="read_button"></a>
Read button event from FlowVR message</h2>
<div class="fragment"><div class="line">data:</div><div class="line">  up: int</div><div class="line">  down: int</div><div class="line"></div><div class="line">...</div><div class="line">    input_ports:</div><div class="line">      keysIn:</div><div class="line">        event_button:</div><div class="line">          KEY_UP: up</div><div class="line">          KEY_DOWN: down</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">int</span> up_state;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;up&quot;</span>, &amp;up_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> down_state;</div><div class="line"><a class="code" href="group__hl__annotation.html#gabf3f81774644eff9a3cf511e57273454">PDI_expose</a>(<span class="stringliteral">&quot;down&quot;</span>, &amp;down_state, <a class="code" href="group__annotation.html#gga7c857647f7a8077648c28db634eeb805a70fa3cd94e02b997794d9eaaea34b0b6">PDI_IN</a>);</div></div><!-- fragment --><h1><a class="anchor" id="flowvr_examples"></a>
FlowVR examples reworked for %PDI</h1>
<p>Path to the examples:</p>
<div class="fragment"><div class="line">pdi/build/pdi_plugin-flowvr/src/FLOWVR_PLUGIN-build/examples/</div></div><!-- fragment --><p>Original flowvr source files are in directories <code>flowvr_original</code>.</p>
<h2><a class="anchor" id="run_app"></a>
Running the application</h2>
<ol type="1">
<li>Go to examples folder: <code>cd pdi_plugin-flowvr/src/FLOWVR_PLUGIN-build/examples</code></li>
<li>Run <code>source flowvr-config.sh</code>. Now your environment is ready.</li>
<li>Run flowvr daemon on your system (best in new terminal, repeat 1. and 2.): <code>flowvrd --top</code></li>
<li>Inside <code>$example_name</code> directory generate the flowvr configuration files by: <code>python $example_name.py</code> and run example by: <code>flowvr $example_name</code></li>
</ol>
<h2><a class="anchor" id="tictac"></a>
Tictac example</h2>
<p>Consists of 2 modules:</p>
<ul>
<li><code>put</code><ul>
<li>source file: <code>put.cxx</code></li>
<li>configuration file: <code>put.yml</code></li>
<li>has <code>output port</code> named <code>text</code></li>
<li>sends message with:<ul>
<li>data: <code>type: {type: array, subtype: char, size: 4} #"tic" or "tac"</code></li>
<li>stamps:<ul>
<li>it (predefined flowvr stamp): <code>type: int</code></li>
<li>my_stamp (user define int array stamp): <code>type: {type: array, subtype: int, size: 2}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>get</code><ul>
<li>source file: <code>get.cxx</code></li>
<li>configuration file: <code>get.yml</code></li>
<li>has <code>input port</code> named <code>text</code></li>
<li>receive message sent by <code>put</code> module</li>
<li>additionally has defined <code>stamp</code>:<ul>
<li>source (predefined flowvr stamp): <code>type: {type: array, subtype: char, size: 256}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>Network of the application:</b></p>
<div class="image">
<img src="tictac_net.jpg" alt="tictac_net.jpg"/>
</div>
<h3><a class="anchor" id="bundle"></a>
Bundle example</h3>
<p>Consists of 3 modules:</p>
<ul>
<li>2x <code>putMulitple</code><ul>
<li>source file: <code>putMulitple.cxx</code></li>
<li>configuration file: <code>putMulitple.yml</code></li>
<li>first one has <code>output port</code> named <code>text</code>, second <code>text2</code></li>
<li>sends message with:<ul>
<li>data: <code>type: {type: array, subtype: char, size: 4} # first "tic" or "tac", second "TIC" or "TAC"</code></li>
<li>stamps:<ul>
<li><code>it</code> (predefined flowvr stamp): <code>type: int</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>getMulitple</code><ul>
<li>source file: <code>getMulitple.cxx</code></li>
<li>configuration file: <code>getMulitple.yml</code></li>
<li>has <code>input ports</code> named <code>text</code> and <code>text2</code></li>
<li>receive message sent by <code>putMulitple</code> modules</li>
<li>additionally has defined <code>stamp</code>:<ul>
<li>source (predefined flowvr stamp): <code>type: {type: array, subtype: char, size: 256}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>Network of the application:</b></p>
<div class="image">
<img src="bundle_net.jpg" alt="bundle_net.jpg"/>
</div>
<h2><a class="anchor" id="primes"></a>
Primes example</h2>
<p>Consists of 3 modules:</p>
<ul>
<li><code>capture</code><ul>
<li>source file: <code>capture.cxx</code></li>
<li>configuration file: <code>capture.yml</code></li>
<li>has <code>output port</code> named <code>keysOut</code></li>
<li>sends message with:<ul>
<li><code>event_button</code> (payload):<ul>
<li>KEY_UP: up</li>
<li>KEY_DOWN: down</li>
<li>KEY_LEFT: left</li>
<li>KEY_RIGHT: right</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>compute</code><ul>
<li>source file: <code>compute.cxx</code></li>
<li>configuration file: <code>compute.yml</code></li>
<li>has <code>output port</code> named <code>primesOut</code></li>
<li>sends message with:<ul>
<li>data (payload): <code>type: {type: array, subtype: int, size: $tempPrimeNumbersMaxCount}</code></li>
<li>stamps:<ul>
<li>computationTimeIt: <code>type: int</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>visu</code><ul>
<li>source file: <code>visu.cxx</code></li>
<li>configuration file: <code>visu.yml</code></li>
<li>has <code>input ports</code> named <code>primesIn</code> and <code>keysIn</code></li>
<li>receive message sent by <code>capture</code> and <code>compute</code> modules</li>
</ul>
</li>
</ul>
<p><b>Network of the application:</b></p>
<div class="image">
<img src="primes_net.jpg" alt="primes_net.jpg"/>
</div>
<h2><a class="anchor" id="fluid"></a>
Fluid example</h2>
<p>Consists of 2 modules:</p>
<ul>
<li><code>fluid</code><ul>
<li>source file: <code>fluid.cxx</code></li>
<li>configuration file: <code>fluid.yml</code></li>
<li>has <code>input port</code> named <code>position</code></li>
<li>received message sent by <code>gldens</code> module</li>
<li>has <code>output ports</code> named <code>velocity</code> and <code>density</code></li>
<li><code>velocity</code> and <code>density</code> both sends message with:<ul>
<li>data (payload): <code>type: {type: array, subtype: char, size: [$NX * 2, $NY]} # where NX and NY is metadata</code></li>
<li>stamps:<ul>
<li>P: <code>type: {type: array, subtype: int, size: 2}</code></li>
<li>N: <code>type: {type: array, subtype: int, size: 2}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>gldens</code><ul>
<li>source file: <code>gldens.cxx</code></li>
<li>configuration file: <code>gldens.yml</code></li>
<li>has <code>input ports</code> named <code>velocity</code> and <code>density</code></li>
<li>received message sent by <code>fluid</code> module</li>
<li>has <code>output port</code> named <code>position</code></li>
<li>sends message with:<ul>
<li>data (payload): <code>type: {type: array, subtype: float, size: 3}</code></li>
</ul>
</li>
<li>very important is how to get a number of elements received by <code>velocity</code> and <code>density</code> ports:<ul>
<li><code>type: {type: array, subtype: char, size: $velocitySize} # velocitySize is defined as metadata</code> Here <code>velocitySize</code> must be preceded with <code>$</code> to let plugin to write the size there. The <code>velocitySize</code> descriptor will store a valid size <b>after</b> accessing the <code>velocity</code> descriptor, because only then plugin will write size.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><b>Network of the application:</b></p>
<div class="image">
<img src="fluid_net.jpg" alt="fluid_net.jpg"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
