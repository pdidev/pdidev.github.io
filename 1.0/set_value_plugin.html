<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="generator" content="Doxygen 1.8.13"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>PDI: Set_value plugin</title>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript" src="dynsections.js"></script>
	<script type="text/javascript" src="navtreedata.js"></script>
	<script type="text/javascript" src="navtree.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div>
<header id="titlearea">
	<div id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png"/></a></div>
	<h1 id="projectname">PDI&nbsp;<span id="projectnumber">1.0.0</span></h1>
	<h2 id="projectbrief">Data exchange made easy</h2>
</header>
<nav id="tabs"><ul>
	<li><a href="index.html">About</a>
	<li><a href="Installation.html">Installation</a>
	<li><a href="PDI_usage.html">PDI usage</a>
	<li><a href="Concepts.html">Core concepts</a>
	<li><a href="First_steps.html">First steps</a>
	<li><a href="Hands_on.html">Tutorial</a>
	<li><a href="PDI_example.html">PDI example</a>
	<li><a href="modules.html">C API reference</a>
	<li><a href="Specification_tree_ref.html">Specification tree</a>
	<li><a href="Plugins.html">Plugins</a>
	<li id="gitlab-ribbon"><a href="https://gitlab.maisondelasimulation.fr/pdidev/pdi">Contribute on Gitlab</a></li>
</ul></nav>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('set_value_plugin.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Set_value plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Set_value plugin allows setting values to data and metadata descriptors from the yaml file.</p>
<p>There are 3 main features:</p><ol type="1">
<li>Share data - plugin will share new allocated data with given values</li>
<li>Expose data - plugin will expose new allocated data with given values</li>
<li>Set data - plugin will set given values to the already shared data</li>
</ol>
<h1><a class="anchor" id="set_value_configuration"></a>
Configuration grammar</h1>
<p>At its root, the Set_value configuration is made of:</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>"on_init"</code> (<em>optional</em>)</td><td align="left">a list of <a class="el" href="set_value_plugin.html#value_operation">value operation</a> </td></tr>
<tr>
<td align="left"><code>"on_event"</code> (<em>optional</em>)</td><td align="left">an <a class="el" href="set_value_plugin.html#on_event_map_node">on_event</a> </td></tr>
<tr>
<td align="left"><code>"on_data"</code> (<em>optional</em>)</td><td align="left">an <a class="el" href="set_value_plugin.html#on_data_map_node">on_data</a> </td></tr>
</table>
<h2><a class="anchor" id="on_init_list_node"></a>
on_init</h2>
<p>Specifies a list of operation to do in <a class="el" href="group__init__final.html#ga3dc660be40c93c169337e3d2692b2ed0">PDI_init</a> function. <code>on_init</code> is a list of <a class="el" href="set_value_plugin.html#value_operation">value operation</a> s.</p>
<div class="fragment"><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_init:</div><div class="line">      - set: ... # value_list</div><div class="line">      - share: ... # value_list</div><div class="line">      - expose: ... # value_list</div></div><!-- fragment --><h2><a class="anchor" id="on_event_map_node"></a>
on_event</h2>
<p>Specifies a map of events that will trigger the values set. <code>on_event</code> is a map with event name as a key and <a class="el" href="set_value_plugin.html#value_operation">value operation</a> list as map value.</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>".*"</code> (<em>optional</em>)</td><td align="left">a list of <a class="el" href="set_value_plugin.html#value_operation">value operation</a> </td></tr>
</table>
<div class="fragment"><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_event:</div><div class="line">      event_1_name:</div><div class="line">        - set: ... # value_list</div><div class="line">        - share: ... # value_list</div><div class="line">        - expose: ... # value_list</div><div class="line">      event_2_name:</div><div class="line">        - set: ... # value_list</div><div class="line">        - share: ... # value_list</div><div class="line">        - expose: ... # value_list</div></div><!-- fragment --><h2><a class="anchor" id="on_data_map_node"></a>
on_data</h2>
<p>Specifies a map of data that on share will trigger the values set. <code>on_data</code> is a map with data/metadata name as a key and <a class="el" href="set_value_plugin.html#value_operation">value operation</a> as map value.</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>".*"</code> (<em>optional</em>)</td><td align="left">a list of <a class="el" href="set_value_plugin.html#value_operation">value operation</a> </td></tr>
</table>
<div class="fragment"><div class="line">metadata:</div><div class="line">  metadata_1_name: ... # metadata_type</div><div class="line">data:</div><div class="line">  data_1_name: ...  # data_type</div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_data:</div><div class="line">      data_1_name:</div><div class="line">        - set: ... # value_list</div><div class="line">        - share: ... # value_list</div><div class="line">        - expose: ... # value_list</div><div class="line">      metadata_1_name:</div><div class="line">        - set: ... # value_list</div><div class="line">        - share: ... # value_list</div><div class="line">        - expose: ... # value_list</div></div><!-- fragment --><h2><a class="anchor" id="value_operation"></a>
value operation</h2>
<p>Defines what operation to do with given <a class="el" href="set_value_plugin.html#value_list">value list</a>. The order of the operation is important and will be called in the same order as defined in yaml file.</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>"set"</code> (<em>optional</em>)</td><td align="left">a <a class="el" href="set_value_plugin.html#value_list">value list</a> </td></tr>
<tr>
<td align="left"><code>"share"</code> (<em>optional</em>)</td><td align="left">a <a class="el" href="set_value_plugin.html#value_list">value list</a> </td></tr>
<tr>
<td align="left"><code>"expose"</code> (<em>optional</em>)</td><td align="left">a <a class="el" href="set_value_plugin.html#value_list">value list</a> </td></tr>
</table>
<p><b>Share warning</b></p>
<p>Share is always done with read and write rights. Plugin allocates memory by <code>malloc</code>. If you reclaim the data, you should free it with <code>free</code> instruction. If you don't reclaim or release data, plugin will try to release all descriptors that has shared before (failure is not an error, so user can reclaim the shared data).</p>
<h2><a class="anchor" id="value_list"></a>
value list</h2>
<p>Is a list of the</p><ul>
<li><a class="el" href="set_value_plugin.html#scalar_value">scalar value</a>,</li>
<li><a class="el" href="set_value_plugin.html#array_value">array value</a>,</li>
<li><a class="el" href="set_value_plugin.html#record_value">record value</a></li>
</ul>
<p>as elements. The order of the elements is important. The descriptors will be set in the same order as given in the yaml file.</p>
<h2><a class="anchor" id="scalar_value"></a>
scalar value</h2>
<p>Is a map of descriptor name as a key, and a value to set as a value:</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>".*"</code> (<em>optional</em>)</td><td align="left">a scalar value to set </td></tr>
</table>
<div class="fragment"><div class="line">metadata:</div><div class="line">  scalar_name: int</div><div class="line">set_value:</div><div class="line">  on_init:</div><div class="line">    - expose:</div><div class="line">      - scalar_name: 42</div></div><!-- fragment --><h2><a class="anchor" id="array_value"></a>
array value</h2>
<p>Is a map of descriptor name as a key, and a list of values to set as a value:</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>".*"</code> (<em>optional</em>)</td><td align="left">a list of value to set </td></tr>
</table>
<div class="fragment"><div class="line">metadata:</div><div class="line">  array_name:</div><div class="line">    type: array</div><div class="line">    size: 4</div><div class="line">    subtype: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_init:</div><div class="line">      - expose:</div><div class="line">        - array_name: [2, 3, 4, 5]</div></div><!-- fragment --><h2><a class="anchor" id="record_value"></a>
record value</h2>
<p>Is a map of descriptor name as a key, and a list of members to set as a value. Each member consist of an inner <code>value_list</code>. The order of the members is unrestricted, but the plugin will set the values to the members in the same order.</p>
<table class="doxtable">
<tr>
<th align="left">key</th><th align="left">value  </th></tr>
<tr>
<td align="left"><code>".*"</code> (<em>optional</em>)</td><td align="left">a map with member name as key and a value to set as value </td></tr>
</table>
<div class="fragment"><div class="line">metadata:</div><div class="line">  record_name:</div><div class="line">    type: record</div><div class="line">    buffersize: 16</div><div class="line">    members:</div><div class="line">      member_1:</div><div class="line">        disp: 0</div><div class="line">        type: array</div><div class="line">        size: 3</div><div class="line">        subtype: int</div><div class="line">      member_2:</div><div class="line">        disp: 12</div><div class="line">        type: int</div><div class="line"></div><div class="line">set_value:</div><div class="line">  on_init:</div><div class="line">    - expose:</div><div class="line">      - record_name:</div><div class="line">          member_2: 3 # int member</div><div class="line">          member_1: [1, 2, 3] # array of ints member</div></div><!-- fragment --><h1><a class="anchor" id="full_config"></a>
full configuration example</h1>
<div class="fragment"><div class="line">metadata:</div><div class="line">  array_size: int64</div><div class="line"></div><div class="line">data:</div><div class="line">  record_data:</div><div class="line">    type: record</div><div class="line">    buffersize: 36</div><div class="line">    members:</div><div class="line">      scalar_data: </div><div class="line">        disp: 0</div><div class="line">        type: int</div><div class="line">      array_data:</div><div class="line">        disp: 4</div><div class="line">        type: array</div><div class="line">        size: $array_size</div><div class="line">        subtype: int</div><div class="line"></div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_init:</div><div class="line">      - expose:</div><div class="line">        - array_size: 3</div><div class="line">      - share:</div><div class="line">        - record_data:</div><div class="line">          - scalar_data: 0</div><div class="line">          - array_data: [0, 0, 0]</div><div class="line">    on_event:</div><div class="line">      event_1_name:</div><div class="line">        - set:</div><div class="line">          - record_data:</div><div class="line">            - scalar_data: 3</div><div class="line">            - array_data: [1, 2, 3]</div></div><!-- fragment --><h1><a class="anchor" id="old_to_new"></a>
Using old values to set new</h1>
<h2><a class="anchor" id="increment"></a>
Increment value</h2>
<p>The set_value plugin allows to use the old values to set new values, you can use even the same descriptor, for example to increment a scalar.</p>
<div class="fragment"><div class="line">data:</div><div class="line">  value_int:</div><div class="line">    type: int</div><div class="line">  int_array:</div><div class="line">    size: 3</div><div class="line">    subtype: int</div><div class="line">    type: array</div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_event:</div><div class="line">      init:</div><div class="line">        - share:</div><div class="line">          - value_int: 0</div><div class="line">          - int_array: [1, 2, 3]</div><div class="line">      increment:</div><div class="line">        - set:</div><div class="line">          - value_int: &quot;$value_int + 1&quot;</div><div class="line">          - int_array: [&quot;$int_array[0] + 1&quot;, &quot;$int_array[1] + 1&quot;, &quot;$int_array[2] + 1&quot;]</div></div><!-- fragment --><p> After calling <code>init</code> and <code>increment</code> event, <code>value_int</code> will be equal 1, and <code>int_array</code> to [2, 3, 4].</p>
<h2><a class="anchor" id="increment_in_array"></a>
Getting old value</h2>
<p>The new value is set at the end of processing the whole descriptors. This means, that if you want to update the array element depending on other element, the old value will be set:</p>
<div class="fragment"><div class="line">metadata:</div><div class="line">  int_array:</div><div class="line">    size: 3</div><div class="line">    subtype: int</div><div class="line">    type: array</div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_event:</div><div class="line">      init:</div><div class="line">        - expose:</div><div class="line">          - int_array: [0, 0, 0]</div><div class="line">      increment:</div><div class="line">        - expose:</div><div class="line">          - int_array: [&quot;$int_array[0] + 1&quot;, &quot;$int_array[0] + 1&quot;, &quot;$int_array[1] + 1&quot;]</div></div><!-- fragment --><p> After calling <code>init</code> and <code>increment</code> event, all values in <code>int_array</code> will equal <code>1</code>. This is because the <code>int_array[0]</code> was updated after setting all the elements.</p>
<h2><a class="anchor" id="update_array_after_scalar"></a>
Getting new value</h2>
<div class="fragment"><div class="line">metadata:</div><div class="line">  int_scalar: int</div><div class="line">  int_array:</div><div class="line">    size: 3</div><div class="line">    subtype: int</div><div class="line">    type: array</div><div class="line">plugins:</div><div class="line">  set_value:</div><div class="line">    on_event:</div><div class="line">      init:</div><div class="line">        - expose:</div><div class="line">          - int_scalar: 0</div><div class="line">          - int_array: [0, 0, 0]</div><div class="line">      increment:</div><div class="line">        - expose:</div><div class="line">          - int_scalar: $int_scalar+1</div><div class="line">          - int_array: [&quot;$int_scalar&quot;, &quot;$int_scalar&quot;, &quot;$int_scalar&quot;]</div></div><!-- fragment --><p> After calling <code>init</code> and <code>increment</code> event, all values in <code>int_array</code> will equal <code>1</code>. This is because the <code>int_scalar</code> is set and then the <code>int_array</code> is updated after the <code>int_scalar</code> has a new value. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</body>
</html>
